<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SSAI AI Builder â€” Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  body { font-family: 'Inter', sans-serif; margin:0; background:#f3f4f6; color:#111; }
  header { background:#4f46e5; color:white; display:flex; justify-content:space-between; align-items:center; padding:16px 24px; box-shadow:0 4px 10px rgba(0,0,0,0.1); }
  header h1 { margin:0; font-size:1.5rem; }
  header button { background:white; color:#4f46e5; border:none; padding:8px 16px; border-radius:6px; cursor:pointer; font-weight:600; }
  header button:hover { background:#e0e0ff; }
  #credits { font-weight:600; }
  
  main { display:flex; flex-wrap:wrap; margin:24px; gap:24px; justify-content:center; }
  .card { background:white; border-radius:12px; padding:16px; flex:1 1 400px; box-shadow:0 4px 16px rgba(0,0,0,0.05); display:flex; flex-direction:column; }
  
  textarea { width:100%; height:120px; border:1px solid #ccc; border-radius:8px; padding:10px; resize:none; font-family: monospace; font-size:0.95rem; }
  button.generate, button.copy { margin-top:12px; background:#4f46e5; color:white; border:none; padding:10px; border-radius:8px; cursor:pointer; font-weight:600; }
  button.generate:hover, button.copy:hover { background:#4338ca; }

  #console { margin-top:12px; background:#111; color:#0f0; font-family: monospace; font-size:0.9rem; padding:12px; border-radius:8px; min-height:80px; overflow-y:auto; }
  #preview { margin-top:12px; background:#f9fafb; padding:12px; border-radius:8px; border:1px solid #ddd; min-height:200px; overflow:auto; font-family: monospace; white-space: pre-wrap; }
  iframe#render { margin-top:12px; border:1px solid #ddd; border-radius:8px; width:100%; min-height:300px; }

  @media(max-width:900px){ main{flex-direction:column;} }
</style>
</head>
<body>

<header>
  <h1>SSAI AI Builder</h1>
  <div id="credits">Credits: --</div>
  <button id="logout">Log Out</button>
</header>

<main>
  <div class="card">
    <h2>AI Agent</h2>
    <textarea id="prompt" placeholder="Describe your website..."></textarea>
    <button class="generate" id="generate">Generate</button>
    <div id="console">Waiting for input...</div>
  </div>

  <div class="card">
    <h2>Live HTML Preview</h2>
    <button class="copy" id="copyBtn">Copy HTML</button>
    <div id="preview">&lt;!-- AI-generated HTML will appear here --&gt;</div>
    <iframe id="render"></iframe>
  </div>
</main>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

// Supabase frontend anon
window.SUPABASE_URL = "https://qtavfdeifmkkyptgfwdl.supabase.co";
window.SUPABASE_ANON_KEY = "PASTE_FULL_ANON_KEY_HERE";
const supabase = createClient(window.SUPABASE_URL, window.SUPABASE_ANON_KEY)

const stored = JSON.parse(localStorage.getItem('ssaib_user')||'{}')
if(!stored.id) window.location.href='/index.html'

const creditsEl = document.getElementById('credits')
const consoleEl = document.getElementById('console')
const previewEl = document.getElementById('preview')
const promptEl = document.getElementById('prompt')
const renderEl = document.getElementById('render')
const copyBtn = document.getElementById('copyBtn')

// Logout
document.getElementById('logout').addEventListener('click', async ()=>{
  await supabase.auth.signOut()
  localStorage.removeItem('ssaib_user')
  window.location.href='/index.html'
})

// Load credits
async function loadCredits(){
  const res = await fetch('/api/getCredits', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({user_id:stored.id})
  })
  const json = await res.json()
  creditsEl.textContent = 'Credits: '+(json.credits??0)
}
loadCredits()

// Generate button
document.getElementById('generate').addEventListener('click', async ()=>{
  const prompt = promptEl.value.trim()
  if(!prompt) return alert('Please enter a prompt!')
  consoleEl.textContent = 'AI is thinking...'
  previewEl.textContent = ''
  renderEl.srcdoc = ''

  try{
    const res = await fetch('/api/generate',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({prompt,user_id:stored.id})
    })
    const data = await res.json()
    if(data.error){
      consoleEl.textContent = 'Error: '+data.error
      return
    }
    consoleEl.textContent = 'Generation complete!'
    previewEl.textContent = data.html
    renderEl.srcdoc = data.html
    loadCredits()
  }catch(err){
    consoleEl.textContent = 'Error: '+err.message
  }
})

// Copy HTML button
copyBtn.addEventListener('click', ()=>{
  navigator.clipboard.writeText(previewEl.textContent)
    .then(()=>{ consoleEl.textContent='HTML copied to clipboard!'; })
    .catch(()=>{ consoleEl.textContent='Failed to copy.'; })
})
</script>

</body>
</html>
